{
  "version": 3,
  "sources": ["../src/utils.ts"],
  "sourcesContent": ["import { compile } from 'path-to-regexp';\r\nimport type Resolver from './resolver/resolver.js';\r\nimport { isFunction, isObject, isString, log, toArray } from './resolver/utils.js';\r\nimport type { Router } from './router.js';\r\nimport type {\r\n  ActionResult,\r\n  AnyObject,\r\n  ChainItem,\r\n  IndexedParams,\r\n  RedirectResult,\r\n  Route,\r\n  RouteContext,\r\n  RouterLocation,\r\n  WebComponentInterface,\r\n} from './types.js';\r\n\r\nexport function ensureRoute<R extends AnyObject, C extends AnyObject>(route?: Route<R, C>): void {\r\n  if (!route || !isString(route.path)) {\r\n    throw new Error(\r\n      log(`Expected route config to be an object with a \"path\" string property, or an array of such objects`),\r\n    );\r\n  }\r\n\r\n  if (\r\n    !isFunction(route.action) &&\r\n    !Array.isArray(route.children) &&\r\n    !isFunction(route.children) &&\r\n    !isString(route.component) &&\r\n    !isString(route.redirect)\r\n  ) {\r\n    throw new Error(\r\n      log(\r\n        `Expected route config \"${route.path}\" to include either \"component, redirect\" ` +\r\n          `or \"action\" function but none found.`,\r\n      ),\r\n    );\r\n  }\r\n\r\n  if (route.redirect) {\r\n    ['bundle', 'component'].forEach((overriddenProp) => {\r\n      if (overriddenProp in route) {\r\n        console.warn(\r\n          log(\r\n            `Route config \"${String(route.path)}\" has both \"redirect\" and \"${overriddenProp}\" properties, ` +\r\n              `and \"redirect\" will always override the latter. Did you mean to only use \"${overriddenProp}\"?`,\r\n          ),\r\n        );\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport function ensureRoutes<R extends AnyObject, C extends AnyObject>(\r\n  routes: Route<R, C> | ReadonlyArray<Route<R, C>>,\r\n): void {\r\n  toArray(routes).forEach((route) => ensureRoute(route));\r\n}\r\n\r\nexport function copyContextWithoutNext<R extends AnyObject, C extends AnyObject>({\r\n  next: _,\r\n  ...context\r\n}: RouteContext<R, C>): Omit<RouteContext<R, C>, 'next'> {\r\n  return context;\r\n}\r\n\r\nexport function getPathnameForRouter<T, R extends AnyObject, C extends AnyObject>(\r\n  pathname: string,\r\n  router: Resolver<T, R, C>,\r\n): string {\r\n  // @ts-expect-error: __effectiveBaseUrl is a private property\r\n  const base = router.__effectiveBaseUrl;\r\n  return base ? new URL(pathname.replace(/^\\//u, ''), base).pathname : pathname;\r\n}\r\n\r\nexport function getMatchedPath(pathItems: ReadonlyArray<Readonly<{ path: string }>>): string {\r\n  return pathItems\r\n    .map((pathItem) => pathItem.path)\r\n    .reduce((a, b) => {\r\n      if (b.length) {\r\n        return `${a.replace(/\\/$/u, '')}/${b.replace(/^\\//u, '')}`;\r\n      }\r\n      return a;\r\n    }, '');\r\n}\r\n\r\nexport function getRoutePath<R extends AnyObject, C extends AnyObject>(chain: ReadonlyArray<ChainItem<R, C>>): string {\r\n  return getMatchedPath(chain.map((chainItem) => chainItem.route));\r\n}\r\n\r\nexport type ResolverOnlyContext<R extends AnyObject, C extends AnyObject> = Readonly<{ resolver: Router<R, C> }>;\r\n\r\ntype PartialRouteContext<R extends AnyObject, C extends AnyObject> = Readonly<{\r\n  chain?: ReadonlyArray<ChainItem<R, C>>;\r\n  hash?: string;\r\n  params?: IndexedParams;\r\n  pathname?: string;\r\n  resolver?: Router<R, C>;\r\n  redirectFrom?: string;\r\n  search?: string;\r\n}>;\r\n\r\nexport function createLocation<R extends AnyObject, C extends AnyObject>({\r\n  resolver,\r\n}: ResolverOnlyContext<R, C>): RouterLocation<R, C>;\r\nexport function createLocation<R extends AnyObject, C extends AnyObject>(\r\n  context: RouteContext<R, C>,\r\n  route?: Route<R, C>,\r\n): RouterLocation<R, C>;\r\nexport function createLocation<R extends AnyObject, C extends AnyObject>(\r\n  { chain = [], hash = '', params = {}, pathname = '', redirectFrom, resolver, search = '' }: PartialRouteContext<R, C>,\r\n  route?: Route<R, C>,\r\n): RouterLocation<R, C> {\r\n  const routes = chain.map((item) => item.route);\r\n  return {\r\n    baseUrl: resolver?.baseUrl ?? '',\r\n    getUrl: (userParams = {}) =>\r\n      resolver ? getPathnameForRouter(compile(getRoutePath(chain))({ ...params, ...userParams } as Partial<Record<string, string[]>>), resolver) : '',\r\n    hash,\r\n    params,\r\n    pathname,\r\n    redirectFrom,\r\n    route: route ?? (Array.isArray(routes) ? routes.at(-1) : undefined) ?? null,\r\n    routes,\r\n    search,\r\n    searchParams: new URLSearchParams(search),\r\n  };\r\n}\r\n\r\nexport function createRedirect<R extends AnyObject, C extends AnyObject>(\r\n  context: RouteContext<R, C>,\r\n  pathname: string,\r\n): RedirectResult {\r\n  const params = { ...context.params };\r\n  return {\r\n    redirect: {\r\n      from: context.pathname,\r\n      params,\r\n      pathname,\r\n    },\r\n  };\r\n}\r\n\r\nexport function renderElement<R extends AnyObject, C extends AnyObject, E extends WebComponentInterface<R, C>>(\r\n  context: RouteContext<R, C>,\r\n  element: E,\r\n): E {\r\n  element.location = createLocation(context);\r\n\r\n  if (context.chain) {\r\n    const index = context.chain.map((item) => item.route).indexOf(context.route);\r\n    context.chain[index].element = element;\r\n  }\r\n\r\n  return element;\r\n}\r\n\r\nexport function maybeCall<R, A extends unknown[], O extends object>(\r\n  callback: ((this: O, ...args: A) => R) | undefined,\r\n  thisArg: O,\r\n  ...args: A\r\n): R | undefined {\r\n  if (typeof callback === 'function') {\r\n    return callback.apply(thisArg, args);\r\n  }\r\n\r\n  return undefined;\r\n}\r\n\r\nexport function amend<\r\n  A extends readonly unknown[],\r\n  N extends keyof O,\r\n  O extends AnyObject & { [key in N]: (this: O, ...args: A) => ActionResult | undefined },\r\n>(fn: keyof O, obj: O | undefined, ...args: A): (result: ActionResult) => ActionResult | undefined {\r\n  return (result: ActionResult) => {\r\n    if (result && isObject(result) && ('cancel' in result || 'redirect' in result)) {\r\n      return result;\r\n    }\r\n\r\n    return maybeCall(obj?.[fn], obj!, ...args);\r\n  };\r\n}\r\n\r\nexport function processNewChildren<R extends AnyObject, C extends AnyObject>(\r\n  newChildren: Route<R, C> | ReadonlyArray<Route<R, C>> | undefined | void,\r\n  route: Route<R, C>,\r\n): void {\r\n  if (!Array.isArray(newChildren) && !isObject(newChildren)) {\r\n    throw new Error(\r\n      log(\r\n        `Incorrect \"children\" value for the route ${String(route.path)}: expected array or object, but got ${String(\r\n          newChildren,\r\n        )}`,\r\n      ),\r\n    );\r\n  }\r\n\r\n  const children = toArray(newChildren);\r\n  children.forEach((child) => ensureRoute(child));\r\n  route.__children = children;\r\n}\r\n\r\nexport function fireRouterEvent(type: string, detail: unknown): boolean {\r\n  return !window.dispatchEvent(new CustomEvent(`vaadin-router-${type}`, { cancelable: type === 'go', detail }));\r\n}\r\n\r\nexport function logValue(value: unknown): string {\r\n  if (typeof value !== 'object') {\r\n    return String(value);\r\n  }\r\n\r\n  const [stringType = 'Unknown'] = / (.*)\\]$/u.exec(String(value)) ?? [];\r\n  if (stringType === 'Object' || stringType === 'Array') {\r\n    return `${stringType} ${JSON.stringify(value)}`;\r\n  }\r\n  return stringType;\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
