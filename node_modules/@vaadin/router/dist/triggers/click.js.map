{
  "version": 3,
  "sources": ["../../src/triggers/click.ts"],
  "sourcesContent": ["import type { NavigationTrigger } from '../types.js';\r\nimport { fireRouterEvent } from '../utils.js';\r\n\r\n/* istanbul ignore next: coverage is calculated in Chrome, this code is for IE */\r\nfunction getAnchorOrigin(anchor: HTMLAnchorElement) {\r\n  // IE11: on HTTP and HTTPS the default port is not included into\r\n  // window.location.origin, so won't include it here either.\r\n  const { port, protocol } = anchor;\r\n  const defaultHttp = protocol === 'http:' && port === '80';\r\n  const defaultHttps = protocol === 'https:' && port === '443';\r\n  const host =\r\n    defaultHttp || defaultHttps\r\n      ? anchor.hostname // does not include the port number (e.g. www.example.org)\r\n      : anchor.host; // does include the port number (e.g. www.example.org:80)\r\n  return `${protocol}//${host}`;\r\n}\r\n\r\nfunction getNormalizedNodeName(e: EventTarget): string | undefined {\r\n  if (!(e instanceof Element)) {\r\n    return undefined;\r\n  }\r\n\r\n  return e.nodeName.toLowerCase();\r\n}\r\n\r\n// TODO: Name correctly when the type purpose is known\r\ntype __Pathable = Readonly<{\r\n  path?: readonly EventTarget[];\r\n}>;\r\n\r\n// The list of checks is not complete:\r\n//  - SVG support is missing\r\n//  - the 'rel' attribute is not considered\r\nfunction vaadinRouterGlobalClickHandler(event: MouseEvent & __Pathable) {\r\n  // ignore the click if the default action is prevented\r\n  if (event.defaultPrevented) {\r\n    return;\r\n  }\r\n\r\n  // ignore the click if not with the primary mouse button\r\n  if (event.button !== 0) {\r\n    return;\r\n  }\r\n\r\n  // ignore the click if a modifier key is pressed\r\n  if (event.shiftKey || event.ctrlKey || event.altKey || event.metaKey) {\r\n    return;\r\n  }\r\n\r\n  // find the <a> element that the click is at (or within)\r\n  let anchorCandidate = event.target;\r\n  const path = event instanceof MouseEvent ? event.composedPath() : ((event as __Pathable).path ?? []);\r\n\r\n  // FIXME(web-padawan): `Symbol.iterator` used by webcomponentsjs is broken for arrays\r\n  // example to check: `for...of` loop here throws the \"Not yet implemented\" error\r\n  // eslint-disable-next-line @typescript-eslint/prefer-for-of\r\n  for (let i = 0; i < path.length; i++) {\r\n    const target = path[i];\r\n    if ('nodeName' in target && (target as Element).nodeName.toLowerCase() === 'a') {\r\n      anchorCandidate = target;\r\n      break;\r\n    }\r\n  }\r\n\r\n  while (anchorCandidate && anchorCandidate instanceof Node && getNormalizedNodeName(anchorCandidate) !== 'a') {\r\n    anchorCandidate = anchorCandidate.parentNode;\r\n  }\r\n\r\n  // ignore the click if not at an <a> element\r\n  if (!anchorCandidate || getNormalizedNodeName(anchorCandidate) !== 'a') {\r\n    return;\r\n  }\r\n\r\n  const anchor = anchorCandidate as HTMLAnchorElement;\r\n\r\n  // ignore the click if the <a> element has a non-default target\r\n  if (anchor.target && anchor.target.toLowerCase() !== '_self') {\r\n    return;\r\n  }\r\n\r\n  // ignore the click if the <a> element has the 'download' attribute\r\n  if (anchor.hasAttribute('download')) {\r\n    return;\r\n  }\r\n\r\n  // ignore the click if the <a> element has the 'router-ignore' attribute\r\n  if (anchor.hasAttribute('router-ignore')) {\r\n    return;\r\n  }\r\n\r\n  // ignore the click if the target URL is a fragment on the current page\r\n  if (anchor.pathname === window.location.pathname && anchor.hash !== '') {\r\n    return;\r\n  }\r\n\r\n  // ignore the click if the target is external to the app\r\n  // In IE11 HTMLAnchorElement does not have the `origin` property\r\n  const origin = anchor.origin || getAnchorOrigin(anchor);\r\n  if (origin !== window.location.origin) {\r\n    return;\r\n  }\r\n\r\n  // if none of the above, convert the click into a navigation event\r\n  const { hash, pathname, search } = anchor;\r\n  if (fireRouterEvent('go', { hash, pathname, search }) && event instanceof MouseEvent) {\r\n    event.preventDefault();\r\n    // for a click event, the scroll is reset to the top position.\r\n    // FIXME: undefined here?\r\n    if (event.type === 'click') {\r\n      window.scrollTo(0, 0);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * A navigation trigger for Vaadin Router that translated clicks on `<a>` links\r\n * into Vaadin Router navigation events.\r\n *\r\n * Only regular clicks on in-app links are translated (primary mouse button, no\r\n * modifier keys, the target href is within the app's URL space).\r\n */\r\nconst CLICK: NavigationTrigger = {\r\n  activate() {\r\n    window.document.addEventListener('click', vaadinRouterGlobalClickHandler);\r\n  },\r\n\r\n  inactivate() {\r\n    window.document.removeEventListener('click', vaadinRouterGlobalClickHandler);\r\n  },\r\n};\r\n\r\nexport default CLICK;\r\n"],
  "mappings": "AACA,SAAS,uBAAuB;AAGhC,SAAS,gBAAgB,QAA2B;AAGlD,QAAM,EAAE,MAAM,SAAS,IAAI;AAC3B,QAAM,cAAc,aAAa,WAAW,SAAS;AACrD,QAAM,eAAe,aAAa,YAAY,SAAS;AACvD,QAAM,OACJ,eAAe,eACX,OAAO,WACP,OAAO;AACb,SAAO,GAAG,QAAQ,KAAK,IAAI;AAC7B;AAEA,SAAS,sBAAsB,GAAoC;AACjE,MAAI,EAAE,aAAa,UAAU;AAC3B,WAAO;AAAA,EACT;AAEA,SAAO,EAAE,SAAS,YAAY;AAChC;AAUA,SAAS,+BAA+B,OAAgC;AAEtE,MAAI,MAAM,kBAAkB;AAC1B;AAAA,EACF;AAGA,MAAI,MAAM,WAAW,GAAG;AACtB;AAAA,EACF;AAGA,MAAI,MAAM,YAAY,MAAM,WAAW,MAAM,UAAU,MAAM,SAAS;AACpE;AAAA,EACF;AAGA,MAAI,kBAAkB,MAAM;AAC5B,QAAM,OAAO,iBAAiB,aAAa,MAAM,aAAa,IAAM,MAAqB,QAAQ,CAAC;AAKlG,WAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AACpC,UAAM,SAAS,KAAK,CAAC;AACrB,QAAI,cAAc,UAAW,OAAmB,SAAS,YAAY,MAAM,KAAK;AAC9E,wBAAkB;AAClB;AAAA,IACF;AAAA,EACF;AAEA,SAAO,mBAAmB,2BAA2B,QAAQ,sBAAsB,eAAe,MAAM,KAAK;AAC3G,sBAAkB,gBAAgB;AAAA,EACpC;AAGA,MAAI,CAAC,mBAAmB,sBAAsB,eAAe,MAAM,KAAK;AACtE;AAAA,EACF;AAEA,QAAM,SAAS;AAGf,MAAI,OAAO,UAAU,OAAO,OAAO,YAAY,MAAM,SAAS;AAC5D;AAAA,EACF;AAGA,MAAI,OAAO,aAAa,UAAU,GAAG;AACnC;AAAA,EACF;AAGA,MAAI,OAAO,aAAa,eAAe,GAAG;AACxC;AAAA,EACF;AAGA,MAAI,OAAO,aAAa,OAAO,SAAS,YAAY,OAAO,SAAS,IAAI;AACtE;AAAA,EACF;AAIA,QAAM,SAAS,OAAO,UAAU,gBAAgB,MAAM;AACtD,MAAI,WAAW,OAAO,SAAS,QAAQ;AACrC;AAAA,EACF;AAGA,QAAM,EAAE,MAAM,UAAU,OAAO,IAAI;AACnC,MAAI,gBAAgB,MAAM,EAAE,MAAM,UAAU,OAAO,CAAC,KAAK,iBAAiB,YAAY;AACpF,UAAM,eAAe;AAGrB,QAAI,MAAM,SAAS,SAAS;AAC1B,aAAO,SAAS,GAAG,CAAC;AAAA,IACtB;AAAA,EACF;AACF;AASA,MAAM,QAA2B;AAAA,EAC/B,WAAW;AACT,WAAO,SAAS,iBAAiB,SAAS,8BAA8B;AAAA,EAC1E;AAAA,EAEA,aAAa;AACX,WAAO,SAAS,oBAAoB,SAAS,8BAA8B;AAAA,EAC7E;AACF;AAEA,IAAO,gBAAQ;",
  "names": []
}
