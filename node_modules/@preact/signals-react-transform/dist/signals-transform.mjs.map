{"version":3,"file":"signals-transform.mjs","sources":["../src/index.ts"],"sourcesContent":["import {\n\ttypes as BabelTypes,\n\ttemplate as BabelTemplate,\n\tPluginObj,\n\tPluginPass,\n\tNodePath,\n\ttemplate,\n} from \"@babel/core\";\nimport { isModule, addNamed } from \"@babel/helper-module-imports\";\nimport type { Scope, VisitNodeObject } from \"@babel/traverse\";\nimport debug from \"debug\";\n\ninterface PluginArgs {\n\ttypes: typeof BabelTypes;\n\ttemplate: typeof BabelTemplate;\n}\n\nconst optOutCommentIdentifier = /(^|\\s)@no(Use|Track)Signals(\\s|$)/;\nconst optInCommentIdentifier = /(^|\\s)@(use|track)Signals(\\s|$)/;\nconst dataNamespace = \"@preact/signals-react-transform\";\nconst defaultImportSource = \"@preact/signals-react/runtime\";\nconst importName = \"useSignals\";\nconst getHookIdentifier = \"getHookIdentifier\";\nconst maybeUsesSignal = \"maybeUsesSignal\";\nconst containsJSX = \"containsJSX\";\nconst alreadyTransformed = \"alreadyTransformed\";\n\nconst UNMANAGED = \"0\";\nconst MANAGED_COMPONENT = \"1\";\nconst MANAGED_HOOK = \"2\";\ntype HookUsage =\n\t| typeof UNMANAGED\n\t| typeof MANAGED_COMPONENT\n\t| typeof MANAGED_HOOK;\n\nconst logger = {\n\ttransformed: debug(\"signals:react-transform:transformed\"),\n\tskipped: debug(\"signals:react-transform:skipped\"),\n};\n\nconst get = (pass: PluginPass, name: any) =>\n\tpass.get(`${dataNamespace}/${name}`);\nconst set = (pass: PluginPass, name: string, v: any) =>\n\tpass.set(`${dataNamespace}/${name}`, v);\n\ninterface DataContainer {\n\tgetData(name: string): any;\n\tsetData(name: string, value: any): void;\n}\nconst setData = (node: DataContainer, name: string, value: any) =>\n\tnode.setData(`${dataNamespace}/${name}`, value);\nconst getData = (node: DataContainer, name: string) =>\n\tnode.getData(`${dataNamespace}/${name}`);\n\nfunction getComponentFunctionDeclaration(\n\tpath: NodePath,\n\tfilename: string | undefined,\n\tprev?: Scope\n): Scope | null {\n\tconst functionScope = path.scope.getFunctionParent();\n\n\tif (functionScope) {\n\t\tconst parent = functionScope.path.parent;\n\t\tlet functionName = getFunctionName(functionScope.path as any);\n\t\tif (functionName === DefaultExportSymbol) {\n\t\t\tfunctionName = filename || null;\n\t\t}\n\t\tif (isComponentFunction(functionScope.path as any, functionName)) {\n\t\t\treturn functionScope;\n\t\t} else if (\n\t\t\tparent.type === \"CallExpression\" &&\n\t\t\tparent.callee.type === \"Identifier\" &&\n\t\t\tparent.callee.name.startsWith(\"use\") &&\n\t\t\tparent.callee.name[3] === parent.callee.name[3].toUpperCase()\n\t\t) {\n\t\t\treturn null;\n\t\t}\n\t\treturn getComponentFunctionDeclaration(\n\t\t\tfunctionScope.parent.path,\n\t\t\tfilename,\n\t\t\tfunctionScope\n\t\t);\n\t} else {\n\t\treturn prev || null;\n\t}\n}\n\nfunction setOnFunctionScope(\n\tpath: NodePath,\n\tkey: string,\n\tvalue: any,\n\tfilename: string | undefined\n) {\n\tconst functionScope = getComponentFunctionDeclaration(path, filename);\n\tif (functionScope) {\n\t\tsetData(functionScope, key, value);\n\t}\n}\n\ntype FunctionLike =\n\t| BabelTypes.ArrowFunctionExpression\n\t| BabelTypes.FunctionExpression\n\t| BabelTypes.FunctionDeclaration\n\t| BabelTypes.ObjectMethod;\n\n/**\n * Simple \"best effort\" to get the base name of a file path. Not fool proof but\n * works in browsers and servers. Good enough for our purposes.\n */\nfunction basename(filename: string | undefined): string | undefined {\n\treturn filename?.split(/[\\\\/]/).pop();\n}\n\nconst DefaultExportSymbol = Symbol(\"DefaultExportSymbol\");\n\nfunction getObjectPropertyKey(\n\tnode: BabelTypes.ObjectProperty | BabelTypes.ObjectMethod\n): string | null {\n\tif (node.key.type === \"Identifier\") {\n\t\treturn node.key.name;\n\t} else if (node.key.type === \"StringLiteral\") {\n\t\treturn node.key.value;\n\t}\n\n\treturn null;\n}\n\n/**\n * If the function node has a name (i.e. is a function declaration with a\n * name), return that. Else return null.\n */\nfunction getFunctionNodeName(node: FunctionLike): string | null {\n\tif (\n\t\t(node.type === \"FunctionDeclaration\" ||\n\t\t\tnode.type === \"FunctionExpression\") &&\n\t\tnode.id\n\t) {\n\t\treturn node.id.name;\n\t} else if (node.type === \"ObjectMethod\") {\n\t\treturn getObjectPropertyKey(node);\n\t}\n\n\treturn null;\n}\n\n/**\n * Given a function path's parent path, determine the \"name\" associated with the\n * function. If the function is an inline default export (e.g. `export default\n * () => {}`), returns a symbol indicating it is a default export. If the\n * function is an anonymous function wrapped in higher order functions (e.g.\n * memo(() => {})) we'll climb through the higher order functions to find the\n * name of the variable that the function is assigned to, if any. Other cases\n * handled too (see implementation). Else returns null.\n */\nfunction getFunctionNameFromParent(\n\tparentPath: NodePath<BabelTypes.Node>\n): string | null | typeof DefaultExportSymbol {\n\tif (\n\t\tparentPath.node.type === \"VariableDeclarator\" &&\n\t\tparentPath.node.id.type === \"Identifier\"\n\t) {\n\t\treturn parentPath.node.id.name;\n\t} else if (parentPath.node.type === \"AssignmentExpression\") {\n\t\tconst left = parentPath.node.left;\n\t\tif (left.type === \"Identifier\") {\n\t\t\treturn left.name;\n\t\t} else if (left.type === \"MemberExpression\") {\n\t\t\tlet property = left.property;\n\t\t\twhile (property.type === \"MemberExpression\") {\n\t\t\t\tproperty = property.property;\n\t\t\t}\n\n\t\t\tif (property.type === \"Identifier\") {\n\t\t\t\treturn property.name;\n\t\t\t} else if (property.type === \"StringLiteral\") {\n\t\t\t\treturn property.value;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t} else if (parentPath.node.type === \"ObjectProperty\") {\n\t\treturn getObjectPropertyKey(parentPath.node);\n\t} else if (parentPath.node.type === \"ExportDefaultDeclaration\") {\n\t\treturn DefaultExportSymbol;\n\t} else if (\n\t\tparentPath.node.type === \"CallExpression\" &&\n\t\tparentPath.parentPath != null\n\t) {\n\t\t// If our parent is a Call Expression, then this function expression is\n\t\t// wrapped in some higher order functions. Recurse through the higher order\n\t\t// functions to determine if this expression is assigned to a name we can\n\t\t// use as the function name\n\t\treturn getFunctionNameFromParent(parentPath.parentPath);\n\t} else {\n\t\treturn null;\n\t}\n}\n\n/* Determine the name of a function */\nfunction getFunctionName(\n\tpath: NodePath<FunctionLike>\n): string | typeof DefaultExportSymbol | null {\n\tlet nodeName = getFunctionNodeName(path.node);\n\tif (nodeName) {\n\t\treturn nodeName;\n\t}\n\n\treturn getFunctionNameFromParent(path.parentPath);\n}\n\nfunction isComponentName(name: string | null): boolean {\n\treturn name?.match(/^[A-Z]/) != null ?? false;\n}\nfunction isCustomHookName(name: string | null): boolean {\n\treturn name?.match(/^use[A-Z]/) != null ?? null;\n}\n\nfunction hasLeadingComment(path: NodePath, comment: RegExp): boolean {\n\tconst comments = path.node.leadingComments;\n\treturn comments?.some(c => c.value.match(comment) !== null) ?? false;\n}\n\nfunction hasLeadingOptInComment(path: NodePath) {\n\treturn hasLeadingComment(path, optInCommentIdentifier);\n}\n\nfunction hasLeadingOptOutComment(path: NodePath) {\n\treturn hasLeadingComment(path, optOutCommentIdentifier);\n}\n\nfunction isOptedIntoSignalTracking(path: NodePath | null): boolean {\n\tif (!path) return false;\n\n\tswitch (path.node.type) {\n\t\tcase \"ArrowFunctionExpression\":\n\t\tcase \"FunctionExpression\":\n\t\tcase \"FunctionDeclaration\":\n\t\tcase \"ObjectMethod\":\n\t\tcase \"ObjectExpression\":\n\t\tcase \"VariableDeclarator\":\n\t\tcase \"VariableDeclaration\":\n\t\tcase \"AssignmentExpression\":\n\t\tcase \"CallExpression\":\n\t\t\treturn (\n\t\t\t\thasLeadingOptInComment(path) ||\n\t\t\t\tisOptedIntoSignalTracking(path.parentPath)\n\t\t\t);\n\t\tcase \"ExportDefaultDeclaration\":\n\t\tcase \"ExportNamedDeclaration\":\n\t\tcase \"ObjectProperty\":\n\t\tcase \"ExpressionStatement\":\n\t\t\treturn hasLeadingOptInComment(path);\n\t\tdefault:\n\t\t\treturn false;\n\t}\n}\n\nfunction isOptedOutOfSignalTracking(path: NodePath | null): boolean {\n\tif (!path) return false;\n\n\tswitch (path.node.type) {\n\t\tcase \"ArrowFunctionExpression\":\n\t\tcase \"FunctionExpression\":\n\t\tcase \"FunctionDeclaration\":\n\t\tcase \"ObjectMethod\":\n\t\tcase \"ObjectExpression\":\n\t\tcase \"VariableDeclarator\":\n\t\tcase \"VariableDeclaration\":\n\t\tcase \"AssignmentExpression\":\n\t\tcase \"CallExpression\":\n\t\t\treturn (\n\t\t\t\thasLeadingOptOutComment(path) ||\n\t\t\t\tisOptedOutOfSignalTracking(path.parentPath)\n\t\t\t);\n\t\tcase \"ExportDefaultDeclaration\":\n\t\tcase \"ExportNamedDeclaration\":\n\t\tcase \"ObjectProperty\":\n\t\tcase \"ExpressionStatement\":\n\t\t\treturn hasLeadingOptOutComment(path);\n\t\tdefault:\n\t\t\treturn false;\n\t}\n}\n\nfunction isComponentFunction(\n\tpath: NodePath<FunctionLike>,\n\tfunctionName: string | null\n): boolean {\n\treturn (\n\t\tgetData(path.scope, containsJSX) === true && // Function contains JSX\n\t\tisComponentName(functionName) // Function name indicates it's a component\n\t);\n}\n\nfunction shouldTransform(\n\tpath: NodePath<FunctionLike>,\n\tfunctionName: string | null,\n\toptions: PluginOptions\n): boolean {\n\t// Opt-out takes first precedence\n\tif (isOptedOutOfSignalTracking(path)) return false;\n\t// Opt-in opts in to transformation regardless of mode\n\tif (isOptedIntoSignalTracking(path)) return true;\n\n\tif (options.mode === \"all\") {\n\t\treturn isComponentFunction(path, functionName);\n\t}\n\n\tif (options.mode == null || options.mode === \"auto\") {\n\t\treturn (\n\t\t\tgetData(path.scope, maybeUsesSignal) === true && // Function appears to use signals;\n\t\t\t(isComponentFunction(path, functionName) ||\n\t\t\t\tisCustomHookName(functionName))\n\t\t);\n\t}\n\n\treturn false;\n}\n\nfunction isValueMemberExpression(\n\tpath: NodePath<BabelTypes.MemberExpression>\n): boolean {\n\treturn (\n\t\t(path.node.property.type === \"Identifier\" &&\n\t\t\tpath.node.property.name === \"value\") ||\n\t\t(path.node.property.type === \"StringLiteral\" &&\n\t\t\tpath.node.property.value === \"value\")\n\t);\n}\n\nconst tryCatchTemplate = template.statements`var STORE_IDENTIFIER = HOOK_IDENTIFIER(HOOK_USAGE);\ntry {\n\tBODY\n} finally {\n\tSTORE_IDENTIFIER.f();\n}`;\n\nfunction wrapInTryFinally(\n\tt: typeof BabelTypes,\n\tpath: NodePath<FunctionLike>,\n\tstate: PluginPass,\n\thookUsage: HookUsage\n): FunctionLike {\n\tconst stopTrackingIdentifier = path.scope.generateUidIdentifier(\"effect\");\n\n\tconst newFunction = t.cloneNode(path.node);\n\tnewFunction.body = t.blockStatement(\n\t\ttryCatchTemplate({\n\t\t\tSTORE_IDENTIFIER: stopTrackingIdentifier,\n\t\t\tHOOK_IDENTIFIER: get(state, getHookIdentifier)(),\n\t\t\tHOOK_USAGE: hookUsage,\n\t\t\tBODY: t.isBlockStatement(path.node.body)\n\t\t\t\t? path.node.body.body // TODO: Is it okay to elide the block statement here?\n\t\t\t\t: t.returnStatement(path.node.body),\n\t\t})\n\t);\n\n\treturn newFunction;\n}\n\nfunction prependUseSignals<T extends FunctionLike>(\n\tt: typeof BabelTypes,\n\tpath: NodePath<T>,\n\tstate: PluginPass\n): T {\n\tconst newFunction = t.cloneNode(path.node);\n\tnewFunction.body = t.blockStatement([\n\t\tt.expressionStatement(\n\t\t\tt.callExpression(get(state, getHookIdentifier)(), [])\n\t\t),\n\t]);\n\tif (t.isBlockStatement(path.node.body)) {\n\t\t// TODO: Is it okay to elide the block statement here?\n\t\tnewFunction.body.body.push(...path.node.body.body);\n\t} else {\n\t\tnewFunction.body.body.push(t.returnStatement(path.node.body));\n\t}\n\n\treturn newFunction;\n}\n\nfunction transformFunction(\n\tt: typeof BabelTypes,\n\toptions: PluginOptions,\n\tpath: NodePath<FunctionLike>,\n\tfunctionName: string | null,\n\tstate: PluginPass\n) {\n\tconst isHook = isCustomHookName(functionName);\n\tconst isComponent = isComponentName(functionName);\n\tconst hookUsage = options.experimental?.noTryFinally\n\t\t? UNMANAGED\n\t\t: isHook\n\t\t? MANAGED_HOOK\n\t\t: isComponent\n\t\t? MANAGED_COMPONENT\n\t\t: UNMANAGED;\n\n\tlet newFunction: FunctionLike;\n\tif (hookUsage !== UNMANAGED) {\n\t\tnewFunction = wrapInTryFinally(t, path, state, hookUsage);\n\t} else {\n\t\tnewFunction = prependUseSignals(t, path, state);\n\t}\n\n\t// Using replaceWith keeps the existing leading comments already so\n\t// we'll clear our cloned node's leading comments to ensure they\n\t// aren't duplicated in the output.\n\tnewFunction.leadingComments = [];\n\n\tsetData(path, alreadyTransformed, true);\n\tpath.replaceWith(newFunction);\n}\n\nfunction createImportLazily(\n\ttypes: typeof BabelTypes,\n\tpass: PluginPass,\n\tpath: NodePath<BabelTypes.Program>,\n\timportName: string,\n\tsource: string\n): () => BabelTypes.Identifier {\n\treturn () => {\n\t\tif (isModule(path)) {\n\t\t\tlet reference: BabelTypes.Identifier = get(pass, `imports/${importName}`);\n\t\t\tif (reference) return types.cloneNode(reference);\n\t\t\treference = addNamed(path, importName, source, {\n\t\t\t\timportedInterop: \"uncompiled\",\n\t\t\t\timportPosition: \"after\",\n\t\t\t});\n\t\t\tset(pass, `imports/${importName}`, reference);\n\n\t\t\t/** Helper function to determine if an import declaration's specifier matches the given importName  */\n\t\t\tconst matchesImportName = (\n\t\t\t\ts: BabelTypes.ImportDeclaration[\"specifiers\"][0]\n\t\t\t) => {\n\t\t\t\tif (s.type !== \"ImportSpecifier\") return false;\n\t\t\t\treturn (\n\t\t\t\t\t(s.imported.type === \"Identifier\" &&\n\t\t\t\t\t\ts.imported.name === importName) ||\n\t\t\t\t\t(s.imported.type === \"StringLiteral\" &&\n\t\t\t\t\t\ts.imported.value === importName)\n\t\t\t\t);\n\t\t\t};\n\n\t\t\tfor (let statement of path.get(\"body\")) {\n\t\t\t\tif (\n\t\t\t\t\tstatement.isImportDeclaration() &&\n\t\t\t\t\tstatement.node.source.value === source &&\n\t\t\t\t\tstatement.node.specifiers.some(matchesImportName)\n\t\t\t\t) {\n\t\t\t\t\tpath.scope.registerDeclaration(statement);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn reference;\n\t\t} else {\n\t\t\t// This code originates from\n\t\t\t// https://github.com/XantreDev/preact-signals/blob/%40preact-signals/safe-react%400.6.1/packages/react/src/babel.ts#L390-L400\n\t\t\tlet reference = get(pass, `requires/${importName}`);\n\t\t\tif (reference) {\n\t\t\t\treference = types.cloneNode(reference);\n\t\t\t} else {\n\t\t\t\treference = addNamed(path, importName, source, {\n\t\t\t\t\timportedInterop: \"uncompiled\",\n\t\t\t\t});\n\t\t\t\tset(pass, `requires/${importName}`, reference);\n\t\t\t}\n\n\t\t\treturn reference;\n\t\t}\n\t};\n}\n\nexport interface PluginOptions {\n\t/**\n\t * Specify the mode to use:\n\t * - `auto`: Automatically wrap all components that use signals.\n\t * - `manual`: Only wrap components that are annotated with `@useSignals` in a JSX comment.\n\t * - `all`: Makes all components reactive to signals.\n\t */\n\tmode?: \"auto\" | \"manual\" | \"all\";\n\t/** Specify a custom package to import the `useSignals` hook from. */\n\timportSource?: string;\n\texperimental?: {\n\t\t/**\n\t\t * If set to true, the component body will not be wrapped in a try/finally\n\t\t * block and instead the next component render or a microtick will stop\n\t\t * tracking signals for this component. This is an experimental feature and\n\t\t * may be removed in the future.\n\t\t * @default false\n\t\t */\n\t\tnoTryFinally?: boolean;\n\t};\n}\n\nfunction log(\n\ttransformed: boolean,\n\tpath: NodePath<FunctionLike>,\n\tfunctionName: string | null,\n\tcurrentFile: string | undefined\n) {\n\tif (!logger.transformed.enabled && !logger.skipped.enabled) return;\n\n\tlet cwd = \"\";\n\tif (typeof process !== undefined && typeof process.cwd == \"function\") {\n\t\tcwd = process.cwd().replace(/\\\\([^ ])/g, \"/$1\");\n\t\tcwd = cwd.endsWith(\"/\") ? cwd : cwd + \"/\";\n\t}\n\n\tconst relativePath = currentFile?.replace(cwd, \"\") ?? \"\";\n\tconst lineNum = path.node.loc?.start.line;\n\tfunctionName = functionName ?? \"<anonymous>\";\n\n\tif (transformed) {\n\t\tlogger.transformed(`${functionName} (${relativePath}:${lineNum})`);\n\t} else {\n\t\tlogger.skipped(`${functionName} (${relativePath}:${lineNum}) %o`, {\n\t\t\thasSignals: getData(path.scope, maybeUsesSignal) ?? false,\n\t\t\thasJSX: getData(path.scope, containsJSX) ?? false,\n\t\t});\n\t}\n}\n\nfunction isComponentLike(\n\tpath: NodePath<FunctionLike>,\n\tfunctionName: string | null\n): boolean {\n\treturn !getData(path, alreadyTransformed) && isComponentName(functionName);\n}\n\nexport default function signalsTransform(\n\t{ types: t }: PluginArgs,\n\toptions: PluginOptions\n): PluginObj {\n\t// TODO: Consider alternate implementation, where on enter of a function\n\t// expression, we run our own manual scan the AST to determine if the\n\t// function uses signals and is a component. This manual scan once upon\n\t// seeing a function would probably be faster than running an entire\n\t// babel pass with plugins on components twice.\n\tconst visitFunction: VisitNodeObject<PluginPass, FunctionLike> = {\n\t\texit(path, state) {\n\t\t\tif (getData(path, alreadyTransformed) === true) return false;\n\n\t\t\tlet functionName = getFunctionName(path);\n\t\t\tif (functionName === DefaultExportSymbol) {\n\t\t\t\tfunctionName = basename(this.filename) ?? null;\n\t\t\t}\n\n\t\t\tif (shouldTransform(path, functionName, state.opts)) {\n\t\t\t\ttransformFunction(t, state.opts, path, functionName, state);\n\t\t\t\tlog(true, path, functionName, this.filename);\n\t\t\t} else if (isComponentLike(path, functionName)) {\n\t\t\t\tlog(false, path, functionName, this.filename);\n\t\t\t}\n\t\t},\n\t};\n\n\treturn {\n\t\tname: \"@preact/signals-transform\",\n\t\tvisitor: {\n\t\t\tProgram: {\n\t\t\t\tenter(path, state) {\n\t\t\t\t\t// Following the pattern of babel-plugin-transform-react-jsx, we\n\t\t\t\t\t// lazily create the import statement for the useSignalTracking hook.\n\t\t\t\t\t// We create a function and store it in the PluginPass object, so that\n\t\t\t\t\t// on the first usage of the hook, we can create the import statement.\n\t\t\t\t\tset(\n\t\t\t\t\t\tstate,\n\t\t\t\t\t\tgetHookIdentifier,\n\t\t\t\t\t\tcreateImportLazily(\n\t\t\t\t\t\t\tt,\n\t\t\t\t\t\t\tstate,\n\t\t\t\t\t\t\tpath,\n\t\t\t\t\t\t\timportName,\n\t\t\t\t\t\t\toptions.importSource ?? defaultImportSource\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t},\n\n\t\t\tArrowFunctionExpression: visitFunction,\n\t\t\tFunctionExpression: visitFunction,\n\t\t\tFunctionDeclaration: visitFunction,\n\t\t\tObjectMethod: visitFunction,\n\n\t\t\tMemberExpression(path) {\n\t\t\t\tif (isValueMemberExpression(path)) {\n\t\t\t\t\tsetOnFunctionScope(path, maybeUsesSignal, true, this.filename);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tJSXElement(path) {\n\t\t\t\tsetOnFunctionScope(path, containsJSX, true, this.filename);\n\t\t\t},\n\t\t\tJSXFragment(path) {\n\t\t\t\tsetOnFunctionScope(path, containsJSX, true, this.filename);\n\t\t\t},\n\t\t},\n\t};\n}\n"],"names":["optOutCommentIdentifier","optInCommentIdentifier","dataNamespace","defaultImportSource","importName","getHookIdentifier","maybeUsesSignal","containsJSX","alreadyTransformed","UNMANAGED","MANAGED_COMPONENT","MANAGED_HOOK","logger","transformed","debug","skipped","get","pass","name","set","v","setData","node","value","getData","getComponentFunctionDeclaration","path","filename","prev","functionScope","scope","getFunctionParent","parent","functionName","getFunctionName","DefaultExportSymbol","isComponentFunction","type","callee","startsWith","toUpperCase","setOnFunctionScope","key","basename","split","pop","Symbol","getObjectPropertyKey","getFunctionNodeName","id","getFunctionNameFromParent","parentPath","left","property","nodeName","isComponentName","_ref","match","isCustomHookName","_ref2","hasLeadingComment","comment","_comments$some","comments","leadingComments","some","c","hasLeadingOptInComment","hasLeadingOptOutComment","isOptedIntoSignalTracking","isOptedOutOfSignalTracking","shouldTransform","options","mode","isValueMemberExpression","tryCatchTemplate","template","statements","_t","_","wrapInTryFinally","t","state","hookUsage","stopTrackingIdentifier","generateUidIdentifier","newFunction","cloneNode","body","blockStatement","STORE_IDENTIFIER","HOOK_IDENTIFIER","HOOK_USAGE","BODY","isBlockStatement","returnStatement","prependUseSignals","expressionStatement","callExpression","push","transformFunction","_options$experimental","isHook","isComponent","experimental","noTryFinally","replaceWith","createImportLazily","types","source","isModule","reference","addNamed","importedInterop","importPosition","matchesImportName","s","imported","statement","isImportDeclaration","specifiers","registerDeclaration","log","currentFile","_currentFile$replace","_path$node$loc","_functionName","enabled","cwd","process","undefined","replace","endsWith","relativePath","lineNum","loc","start","line","_getData","_getData2","hasSignals","hasJSX","isComponentLike","signalsTransform","visitFunction","exit","_basename","opts","visitor","Program","enter","_options$importSource","importSource","ArrowFunctionExpression","FunctionExpression","FunctionDeclaration","ObjectMethod","MemberExpression","JSXElement","JSXFragment"],"mappings":"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"}